<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.abandon.mapper.EnquipmentMapper">
  <resultMap id="BaseResultMap" type="EnquipmentInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 17 23:21:18 CST 2018.
    -->
    <id column="enquipment_id" jdbcType="INTEGER" property="enquipmentId" />
    <result column="user_id" jdbcType="VARCHAR" property="userId" />
    <result column="meetingroom_id" jdbcType="INTEGER" property="meetingroomId" />
    <result column="enquipment_name" jdbcType="VARCHAR" property="enquipmentName" />
    <result column="procurement_time" jdbcType="TIMESTAMP" property="procurementTime" />
    <result column="enquipment_price" jdbcType="DOUBLE" property="enquipmentPrice" />
    <result column="enquipment_remerk" jdbcType="VARCHAR" property="enquipmentRemerk" />
     <result column="user_name" jdbcType="VARCHAR" property="userName" />
      <result column="meetingroom_name" jdbcType="VARCHAR" property="meetingroomName" />
  </resultMap>
 	<!-- 添加设备信息 -->
 	<insert id="addEnqiument" parameterType="EnquipmentInfo">
 		insert into enquipment_info (user_id,enquipment_name,procurement_time,enquipment_price,enquipment_remerk)
 		values(#{userId},#{enquipmentName},#{procurementTime},#{enquipmentPrice},#{enquipmentRemerk})
 	</insert>
  	<!-- 查询全部设备信息 -->
  	<select id="getAllEnquipmentInfo" parameterType="EnquipmentInfo" resultMap="BaseResultMap">
  		select*from enquipment_info
  		<where>
  			<if test="enquipmentName!=null and ''!=enquipmentName">
  				and enquipment_name like #{enquipmentName}
  			</if>  			
  		</where> 	  	
  	</select>
  	<!-- 查询未使用设备信息 -->
  	<select id="getNotUseEnquipmentInfo" parameterType="EnquipmentInfo" resultMap="BaseResultMap">
  		select * from enquipment_info where meetingroom_id is null
  	
  	</select>
  	<!-- 根据设备id查询设备信息 -->
  	<select id="getEnquipmentInfo" parameterType="String" resultMap="BaseResultMap">
  		select*from enquipment_info where
  			enquipment_id=#{enquipmentId}
  	</select>
  	<!-- 修改设备信息 -->
  	<update id="updateEnquipmentInfo" parameterType="EnquipmentInfo" >
  		update  enquipment_info set 
  		enquipment_name=#{enquipmentName},enquipment_price=#{enquipmentPrice},enquipment_remerk=#{enquipmentRemerk},meetingroom_id=#{meetingroomId}
  		where enquipment_id=#{enquipmentId}
  	</update>
  	<!-- 根据id删除设备信息 -->
  	<delete id="deleteEnquipmentInfo" parameterType="Integer" >
  		delete from enquipment_info where
  			enquipment_id=#{enquipmentId}
  		 
  	</delete>
  	<!-- 查询设备信息 -->
  	<select id="selectEnquipmentInfo" parameterType="EnquipmentInfo" resultMap="BaseResultMap">
  		SELECT
			x.*,
			y.meetingroom_name 
		FROM
			( SELECT a.*, b.user_name FROM enquipment_info a, user_info b WHERE a.user_id = b.user_id 
				<if test="enquipmentName!=null and ''!=enquipmentName" >
					and a.enquipment_name like #{enquipmentName}
				</if>
				<if test="meetingroomId!=null and ''!=meetingroomId">
					and a.meetingroom_id =#{meetingroomId}
				</if>			
			) x
			LEFT JOIN meetingroom_info y ON x.meetingroom_id = y.meetingroom_id 
			
  	</select>
  	<!-- 更具id多表联查 -->
  	<select id="gettTwoEnquipmentInfo" parameterType="String" resultMap="BaseResultMap">
  		SELECT
			x.*,
			y.meetingroom_name 
		FROM
			( SELECT a.*, b.user_name FROM enquipment_info a, user_info b WHERE a.user_id = b.user_id 
				and a.enquipment_id=#{enquipmentId}
			) x
			LEFT JOIN meetingroom_info y ON x.meetingroom_id = y.meetingroom_id
  	</select>
  	<!-- 更新设备会议室id -->
  	<update id="updateMeetingroomID" parameterType="EnquipmentInfo" >
  		update enquipment_info set meetingroom_id=#{meetingroomId}
  		where enquipment_id=#{enquipmentId}
  	</update>
  	<!-- 根据会议室id查询设备信息 -->
  	<select id="getMroomIdEnquipmentInfo" parameterType="String" resultMap="BaseResultMap">
  		select * from enquipment_info where 
  		 meetingroom_id=#{meetingroomId}
  	</select>
</mapper>