<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.abandon.mapper.BespeakMapper">
  <resultMap id="MeetingroomSettingMap" type="com.abandon.domain.MeetingroomSetting">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 17 23:21:18 CST 2018.
    -->
    <id column="bespeak_id" jdbcType="INTEGER" property="bespeakId" />
    <result column="meetingroom_id" jdbcType="INTEGER" property="meetingroomId" />
    <result column="user_id" jdbcType="VARCHAR" property="userId" />
    <result column="apply_time" jdbcType="TIMESTAMP" property="applyTime" />
    <result column="meeting_name" jdbcType="VARCHAR" property="meetingName" />
    <result column="strat_time" jdbcType="TIMESTAMP" property="stratTime" />
    <result column="end_time" jdbcType="TIMESTAMP" property="endTime" />
    <result column="meetingroom_note" jdbcType="VARCHAR" property="meetingroomNote" />
    <result column="bespeak_state" jdbcType="VARCHAR" property="bespeakState" />
    <result column="auditing_man" jdbcType="VARCHAR" property="auditingMan" />
    <result column="auditing_time" jdbcType="TIMESTAMP" property="auditingTime" />
    <result column="auditing_info" jdbcType="VARCHAR" property="auditingInfo" />
     <result column="user_name" jdbcType="VARCHAR" property="userName" />
      <result column="meetingroom_name" jdbcType="VARCHAR" property="meetingroomName" />
  </resultMap>
  <!-- 添加会议室信息  bespeakState = 0 未审核状态-->
  <insert id="AddmeetingroomSetting" parameterType="MeetingroomSetting" >
  		insert into meetingroom_setting (bespeak_id,meetingroom_id,user_id,apply_time,meeting_name,strat_time,end_time,meetingroom_note,bespeak_state)
  		values (#{bespeakId},#{meetingroomId},#{userId},now(),#{meetingName},#{stratTime},#{endTime},#{meetingroomNote},'0')
  </insert>
  <!-- 查询多个会议室预约信息 (模糊差)-->
  <select id="getAllMeetingroomSetting" parameterType="MeetingroomSetting"  resultMap="MeetingroomSettingMap">
  			SELECT
	           	a.*,
				b.user_name ,
				c.meetingroom_name
			FROM
				meetingroom_setting a,
				user_info b ,
				meetingroom_info c	
			WHERE	
	 			a.user_id =b.user_id
	 			and a.meetingroom_id=c.meetingroom_id
			<if test="bespeakState!=null and bespeakState!=''">	
				and  a.bespeak_state = #{bespeakState}
			</if>
  		<if test="meetingName!=null and ''!=meetingName">
  				and a.meeting_name like #{meetingName}  		
  		</if>
  		<if test="userId!=null and ''!=userId">
  				and a.user_id = #{userId}
  		</if>
  		<if test="auditingMan!=null and auditingMan!=''">
  				and a.auditing_man=#{auditingMan}
  		</if>
  		<if test="mark!=null and mark=='-1'">	
				and  a.bespeak_state != '0'
			</if>
  		 
  		order by a.bespeak_id desc		  	
  </select>
  <!-- 根据id查询会议室预约信息 -->
  <select id="getMeetingroomSetting" parameterType="String" resultMap="MeetingroomSettingMap">
  		Select a.* 
  		,b.meetingroom_name 
  		,c.user_name
  		from 
  		meetingroom_setting a,
  		meetingroom_info b,
  		user_info c
  		where
  		 a.bespeak_id = #{bespeakId}
  		 and  a.meetingroom_id=b.meetingroom_id
  		 and  a.user_id=c.user_id
  		 
  </select>
  <!-- 更新会议预约信息 -->
  <update id="updatemeetingroomSetting" parameterType="MeetingroomSetting" >
  		update meetingroom_setting set meeting_name=#{meetingName},strat_time=#{stratTime},end_time=#{endTime},meetingroom_note=#{meetingroomNote}
  			<if test="bespeakState!=null and ''!=bespeakState">
  				,bespeak_state=#{bespeakState}  				
  			</if>
  			where bespeak_id=#{bespeakId}
  </update>
  <!-- 更新会议预约状态 -->
  <update id="updateBespeakAuditing" parameterType="MeetingroomSetting">
  	update meetingroom_setting set bespeak_state=#{bespeakState},auditing_man=#{auditingMan},auditing_info=#{auditingInfo},auditing_time=now()
  		where bespeak_id=#{bespeakId}
  </update>
  
</mapper>